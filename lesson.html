<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ders | YKS Hazƒ±rlƒ±k Platformu</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0a0f1a;
            --bg-secondary: #0f172a;
            --surface: #1e293b;
            --border: rgba(255, 255, 255, 0.08);
            --text: #f1f5f9;
            --text-muted: #94a3b8;
            --primary: #3b82f6;
            --secondary: #8b5cf6;
            --gradient: linear-gradient(135deg, var(--primary), var(--secondary));
            --success: #22c55e;
            --warning: #f59e0b;
            --radius: 16px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
        }

        .bg-glow {
            position: fixed;
            width: 600px;
            height: 600px;
            border-radius: 50%;
            filter: blur(150px);
            opacity: 0.1;
            pointer-events: none;
            z-index: 0;
        }

        .bg-glow-1 {
            top: -200px;
            left: -100px;
            background: var(--primary);
        }

        .bg-glow-2 {
            bottom: -200px;
            right: -100px;
            background: var(--secondary);
        }

        .header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(10, 15, 26, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            padding: 16px 24px;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
            color: var(--text);
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--gradient);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .logo-text {
            font-size: 18px;
            font-weight: 700;
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: var(--text-muted);
        }

        .breadcrumb a {
            color: var(--text-muted);
            text-decoration: none;
            transition: color 0.2s;
        }

        .breadcrumb a:hover {
            color: var(--text);
        }

        .breadcrumb-sep {
            opacity: 0.5;
        }

        .breadcrumb-current {
            color: var(--text);
            font-weight: 500;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 18px;
            border-radius: 10px;
            font-weight: 500;
            font-size: 14px;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
            text-decoration: none;
            font-family: inherit;
        }

        .btn-outline {
            background: transparent;
            color: var(--text-muted);
            border: 1px solid var(--border);
        }

        .btn-outline:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text);
        }

        .btn-primary {
            background: var(--gradient);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.3);
        }

        .btn-success {
            background: rgba(34, 197, 94, 0.2);
            color: #86efac;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .btn-danger {
            background: rgba(239, 68, 68, 0.15);
            color: #fca5a5;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .main {
            max-width: 1400px;
            margin: 0 auto;
            padding: 32px 24px;
            position: relative;
            z-index: 1;
        }

        .lesson-layout {
            display: grid;
            grid-template-columns: 1fr 360px;
            gap: 32px;
        }

        /* Video Section */
        .video-section {
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.06) 0%, rgba(255, 255, 255, 0.02) 100%);
            border: 1px solid var(--border);
            border-radius: 20px;
            overflow: hidden;
        }

        .video-container {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%;
            background: #000;
        }

        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        .video-placeholder {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(139, 92, 246, 0.2));
        }

        .video-placeholder-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        .video-placeholder-text {
            font-size: 18px;
            font-weight: 600;
        }

        /* Video Error Overlay */
        .video-error-overlay {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(139, 92, 246, 0.1));
            backdrop-filter: blur(4px);
            z-index: 10;
        }

        .video-error-icon {
            font-size: 56px;
            margin-bottom: 16px;
        }

        .video-error-title {
            font-size: 20px;
            font-weight: 700;
            color: #fca5a5;
            margin-bottom: 8px;
        }

        .video-error-message {
            font-size: 14px;
            color: var(--text-muted);
            text-align: center;
            max-width: 300px;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .video-error-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.4);
            border-radius: 10px;
            color: #fca5a5;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .video-error-btn:hover {
            background: rgba(239, 68, 68, 0.3);
            transform: translateY(-1px);
        }

        #playerContainer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        /* Play Overlay for VBO tracking */
        .play-overlay {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.6);
            cursor: pointer;
            z-index: 5;
            transition: opacity 0.3s;
        }

        .play-overlay:hover {
            background: rgba(0, 0, 0, 0.4);
        }

        .play-overlay-icon {
            width: 80px;
            height: 80px;
            background: var(--gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            margin-bottom: 16px;
            box-shadow: 0 8px 32px rgba(59, 130, 246, 0.4);
            transition: transform 0.2s;
        }

        .play-overlay:hover .play-overlay-icon {
            transform: scale(1.1);
        }

        .play-overlay-text {
            font-size: 16px;
            font-weight: 600;
            color: white;
        }

        /* Custom Video Controls */
        .custom-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.9));
            padding: 20px 16px 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 10;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .video-container:hover .custom-controls,
        .custom-controls.visible {
            opacity: 1;
        }

        .ctrl-btn {
            width: 40px;
            height: 40px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .ctrl-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        .ctrl-btn.active {
            background: var(--primary);
        }

        .ctrl-btn.play-btn {
            width: 44px;
            height: 44px;
            background: var(--gradient);
            font-size: 20px;
        }

        .ctrl-btn.play-btn:hover {
            box-shadow: 0 4px 16px rgba(59, 130, 246, 0.4);
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .volume-slider {
            width: 80px;
            height: 4px;
            -webkit-appearance: none;
            appearance: none;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            cursor: pointer;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 12px;
            height: 12px;
            background: white;
            border-radius: 50%;
            cursor: pointer;
        }

        .time-display {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.8);
            font-family: 'Inter', monospace;
            flex-shrink: 0;
        }

        .progress-bar-container {
            flex: 1;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
            cursor: not-allowed;
        }

        .progress-bar-fill {
            height: 100%;
            background: var(--gradient);
            width: 0%;
            transition: width 0.5s linear;
        }

        .speed-control {
            position: relative;
        }

        .speed-btn {
            padding: 4px 10px;
            font-size: 12px;
            font-weight: 600;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .speed-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .speed-menu {
            position: absolute;
            bottom: 100%;
            right: 0;
            background: rgba(30, 41, 59, 0.98);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 8px 0;
            margin-bottom: 8px;
            display: none;
            min-width: 100px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .speed-menu.show {
            display: block;
        }

        .speed-option {
            display: block;
            width: 100%;
            padding: 8px 16px;
            text-align: left;
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .speed-option:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .speed-option.active {
            color: var(--primary);
            font-weight: 600;
        }

        /* Interaction Blocker - prevents seeking */
        .interaction-blocker {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 60px;
            z-index: 8;
            cursor: default;
        }


        .video-info {
            padding: 24px;
        }

        .video-title {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 12px;
        }

        .video-meta {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .video-meta-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            color: var(--text-muted);
        }

        /* VBO Progress */
        .vbo-section {
            padding: 20px 24px;
            border-top: 1px solid var(--border);
            background: rgba(59, 130, 246, 0.05);
        }

        .vbo-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .vbo-label {
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .vbo-percent {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary);
        }

        .vbo-bar {
            width: 100%;
            height: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 100px;
            overflow: hidden;
        }

        .vbo-fill {
            height: 100%;
            background: var(--gradient);
            border-radius: 100px;
            transition: width 0.5s ease;
        }

        .vbo-complete {
            background: var(--success);
        }

        .vbo-hint {
            margin-top: 10px;
            font-size: 12px;
            color: var(--text-muted);
        }

        /* Video Controls */
        .video-controls {
            padding: 20px 24px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        /* Sidebar */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .sidebar-card {
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.06) 0%, rgba(255, 255, 255, 0.02) 100%);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
        }

        .sidebar-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Video List */
        .video-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 400px;
            overflow-y: auto;
        }

        .video-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            color: var(--text);
        }

        .video-item:hover {
            background: rgba(255, 255, 255, 0.06);
        }

        .video-item.active {
            background: rgba(59, 130, 246, 0.15);
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .video-item.completed .video-item-number {
            background: var(--success);
            color: white;
        }

        .video-item-number {
            width: 28px;
            height: 28px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            flex-shrink: 0;
        }

        .video-item-info {
            flex: 1;
        }

        .video-item-title {
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 2px;
        }

        .video-item-duration {
            font-size: 11px;
            color: var(--text-muted);
        }

        .video-item-status {
            font-size: 16px;
        }

        /* Topic Progress */
        .topic-progress {
            margin-bottom: 16px;
        }

        .topic-progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 13px;
        }

        .topic-progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 100px;
            overflow: hidden;
        }

        .topic-progress-fill {
            height: 100%;
            background: var(--gradient);
            border-radius: 100px;
        }

        /* Actions Card */
        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .action-buttons .btn {
            justify-content: center;
            width: 100%;
        }

        @media (max-width: 1024px) {
            .lesson-layout {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header-left {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }

            .video-info {
                padding: 16px;
            }
        }
    </style>
</head>

<body>
    <div class="bg-glow bg-glow-1"></div>
    <div class="bg-glow bg-glow-2"></div>

    <header class="header">
        <div class="header-content">
            <div class="header-left">
                <a href="student_dashboard.html" class="logo">
                    <div class="logo-icon">üìö</div>
                    <span class="logo-text">SEBA Akademi</span>
                </a>
                <nav class="breadcrumb">
                    <a href="student_dashboard.html">Ana Panel</a>
                    <span class="breadcrumb-sep">‚Ä∫</span>
                    <a href="courses.html" id="breadcrumbCategory">TYT</a>
                    <span class="breadcrumb-sep">‚Ä∫</span>
                    <a href="topics.html" id="breadcrumbCourse">Matematik</a>
                    <span class="breadcrumb-sep">‚Ä∫</span>
                    <span class="breadcrumb-current" id="breadcrumbTopic">Konu</span>
                </nav>
            </div>
            <div class="header-right">
                <a href="topics.html" class="btn btn-outline" id="backToTopics">‚Üê Konulara D√∂n</a>
                <button class="btn btn-danger" onclick="logout()">üö™ √áƒ±kƒ±≈ü</button>
            </div>
        </div>
    </header>

    <main class="main">
        <div class="lesson-layout">
            <!-- Video Section -->
            <div class="video-section">
                <div class="video-container" id="videoContainer">
                    <div id="playerContainer"></div>
                    <div class="video-placeholder" id="videoPlaceholder">
                        <div class="video-placeholder-icon">‚ñ∂Ô∏è</div>
                        <div class="video-placeholder-text">Video Y√ºkleniyor...</div>
                    </div>
                </div>

                <div class="video-info">
                    <h1 class="video-title" id="videoTitle">Video Ba≈ülƒ±ƒüƒ±</h1>
                    <div class="video-meta">
                        <span class="video-meta-item">üìö <span id="metaCourse">Matematik</span></span>
                        <span class="video-meta-item">üìã <span id="metaTopic">Konu</span></span>
                        <span class="video-meta-item">‚è±Ô∏è <span id="metaDuration">15 dk</span></span>
                        <span class="video-meta-item">üé¨ Video <span id="metaVideoNumber">1</span>/<span
                                id="metaTotalVideos">5</span></span>
                    </div>
                </div>

                <!-- VBO Section -->
                <div class="vbo-section">
                    <div class="vbo-header">
                        <span class="vbo-label">üìä Video ƒ∞zleme Oranƒ± (VBO)</span>
                        <span class="vbo-percent" id="vboPercent">%0</span>
                    </div>
                    <div class="vbo-bar">
                        <div class="vbo-fill" id="vboFill" style="width: 0%"></div>
                    </div>
                    <p class="vbo-hint" id="vboHint">Videoyu izledik√ße VBO oranƒ±nƒ±z artacaktƒ±r. %80 ve √ºzeri tamamlanmƒ±≈ü
                        sayƒ±lƒ±r.</p>
                </div>

                <!-- Controls -->
                <div class="video-controls">
                    <button class="btn btn-outline" onclick="prevVideo()" id="prevBtn">‚¨ÖÔ∏è √ñnceki Video</button>
                    <button class="btn btn-primary" onclick="nextVideo()" id="nextBtn">Sonraki Video ‚û°Ô∏è</button>
                    <button class="btn btn-success" onclick="markComplete()" id="completeBtn">‚úì Tamamlandƒ± Olarak
                        ƒ∞≈üaretle</button>
                </div>
            </div>

            <!-- Sidebar -->
            <aside class="sidebar">
                <!-- Topic Progress -->
                <div class="sidebar-card">
                    <h3 class="sidebar-title">üìà Konu ƒ∞lerlemesi</h3>
                    <div class="topic-progress">
                        <div class="topic-progress-header">
                            <span id="progressLabel">0/5 Video</span>
                            <span id="progressPercent">%0</span>
                        </div>
                        <div class="topic-progress-bar">
                            <div class="topic-progress-fill" id="topicProgressFill" style="width: 0%"></div>
                        </div>
                    </div>
                    <p style="font-size: 13px; color: var(--text-muted);" id="topicStatus">
                        T√ºm videolarƒ± tamamlayƒ±nca teste ge√ßebilirsiniz.
                    </p>
                </div>

                <!-- Video List -->
                <div class="sidebar-card">
                    <h3 class="sidebar-title">üé¨ Konu Videolarƒ±</h3>
                    <div class="video-list" id="videoList">
                        <!-- Videos will be loaded here -->
                    </div>
                </div>

                <!-- Actions -->
                <div class="sidebar-card">
                    <h3 class="sidebar-title">‚ö° Hƒ±zlƒ± ƒ∞≈ülemler</h3>
                    <div class="action-buttons">
                        <button class="btn btn-outline" onclick="goToTest()" id="testBtn">üìù Konu Testine Git</button>
                        <a href="topics.html" class="btn btn-outline" id="topicsLink">üìã T√ºm Konularƒ± G√∂r</a>
                    </div>
                </div>
            </aside>
        </div>
    </main>

    <script>
        // =====================================================
        // VIDEO DATA CONFIGURATION
        // =====================================================
        // To add/change video IDs, edit the youtubeId values below.
        // Video ID Format: The YouTube video ID from the URL
        // Example: https://www.youtube.com/watch?v=dQw4w9WgXcQ -> youtubeId: 'dQw4w9WgXcQ'
        // =====================================================

        const VIDEO_CONFIG = {
            // =====================================================
            // EMBED EDƒ∞LEBƒ∞LEN Vƒ∞DEO ID'LERƒ∞
            // Bu videolar YouTube'da embed izni olan herkese a√ßƒ±k videolardƒ±r
            // Kendi videolarƒ±nƒ±zƒ± eklemek i√ßin youtubeId deƒüerlerini deƒüi≈ütirin
            // =====================================================

            // Matematik Dersleri
            'mat': {
                // Konu 1: Temel Kavramlar
                1: [
                    // NOT: UqXVgAmqBOs video ID'si Hata 153 veriyor - embed izni kapalƒ± olabilir
                    // Test i√ßin ge√ßici olarak √ßalƒ±≈üan bir video ID kullanƒ±yoruz
                    // Kendi videolarƒ±nƒ±zƒ± eklemek i√ßin youtubeId deƒüerlerini deƒüi≈ütirin
                    { id: 1, title: 'Temel Kavramlar - Giri≈ü', youtubeId: 'dQw4w9WgXcQ', duration: '12:30' },
                    { id: 2, title: 'Sayƒ± Sistemleri', youtubeId: 'YJEUhgbrg8M', duration: '15:45' },
                    { id: 3, title: 'Doƒüal Sayƒ±lar', youtubeId: 'UqXVgAmqBOs', duration: '18:20' }
                ],
                // Konu 2: Sayƒ± Basamaklarƒ±
                2: [
                    { id: 1, title: 'Sayƒ± Basamaklarƒ± - Giri≈ü', youtubeId: 'UqXVgAmqBOs', duration: '14:15' },
                    { id: 2, title: 'Basamak Deƒüeri ve Sayƒ± Deƒüeri', youtubeId: 'UqXVgAmqBOs', duration: '16:30' },
                    { id: 3, title: 'Soru √á√∂z√ºmleri', youtubeId: 'UqXVgAmqBOs', duration: '20:00' },
                    { id: 4, title: 'ƒ∞leri Seviye Sorular', youtubeId: 'UqXVgAmqBOs', duration: '22:45' }
                ],
                // Konu 3: B√∂lme ve B√∂l√ºnebilme
                3: [
                    { id: 1, title: 'B√∂lme ve B√∂l√ºnebilme', youtubeId: 'UqXVgAmqBOs', duration: '15:00' },
                    { id: 2, title: 'B√∂l√ºnebilme Kurallarƒ±', youtubeId: 'UqXVgAmqBOs', duration: '18:30' },
                    { id: 3, title: 'Asal √áarpanlara Ayƒ±rma', youtubeId: 'UqXVgAmqBOs', duration: '14:45' },
                    { id: 4, title: 'Soru √á√∂z√ºmleri', youtubeId: 'UqXVgAmqBOs', duration: '25:00' },
                    { id: 5, title: '√ñSYM Tarzƒ± Sorular', youtubeId: 'UqXVgAmqBOs', duration: '20:15' }
                ],
                // Konu 4: EBOB - EKOK
                4: [
                    { id: 1, title: 'EBOB Kavramƒ±', youtubeId: 'UqXVgAmqBOs', duration: '16:00' },
                    { id: 2, title: 'EKOK Kavramƒ±', youtubeId: 'UqXVgAmqBOs', duration: '14:30' },
                    { id: 3, title: 'EBOB-EKOK Problemleri', youtubeId: 'UqXVgAmqBOs', duration: '22:00' }
                ],
                // Konu 5: Rasyonel Sayƒ±lar
                5: [
                    { id: 1, title: 'Rasyonel Sayƒ±lar - Giri≈ü', youtubeId: 'UqXVgAmqBOs', duration: '18:00' },
                    { id: 2, title: 'Kesirler ve ƒ∞≈ülemler', youtubeId: 'UqXVgAmqBOs', duration: '20:15' },
                    { id: 3, title: 'Ondalƒ±k G√∂sterim', youtubeId: 'UqXVgAmqBOs', duration: '15:30' }
                ]
            },
            // T√ºrk√ße Dersleri
            'trk': {
                1: [
                    { id: 1, title: 'S√∂zc√ºk T√ºrleri - Giri≈ü', youtubeId: 'UqXVgAmqBOs', duration: '10:00' },
                    { id: 2, title: 'ƒ∞simler ve Sƒ±fatlar', youtubeId: 'UqXVgAmqBOs', duration: '15:30' },
                    { id: 3, title: 'Fiiller', youtubeId: 'UqXVgAmqBOs', duration: '18:00' },
                    { id: 4, title: 'Soru √á√∂z√ºmleri', youtubeId: 'UqXVgAmqBOs', duration: '22:00' }
                ],
                2: [
                    { id: 1, title: 'C√ºmle Bilgisi - Giri≈ü', youtubeId: 'UqXVgAmqBOs', duration: '12:00' },
                    { id: 2, title: '√ñzne ve Y√ºklem', youtubeId: 'UqXVgAmqBOs', duration: '16:45' }
                ]
            },
            // Fizik Dersleri
            'fiz': {
                1: [
                    { id: 1, title: 'Fizik ve √ñl√ßme', youtubeId: 'UqXVgAmqBOs', duration: '14:00' },
                    { id: 2, title: 'Birim Sistemleri', youtubeId: 'UqXVgAmqBOs', duration: '12:30' }
                ]
            },
            // Kimya Dersleri
            'kim': {
                1: [
                    { id: 1, title: 'Kimya Bilimi', youtubeId: 'UqXVgAmqBOs', duration: '15:00' },
                    { id: 2, title: 'Atom ve Yapƒ±sƒ±', youtubeId: 'UqXVgAmqBOs', duration: '18:00' }
                ]
            },
            // Biyoloji Dersleri
            'bio': {
                1: [
                    { id: 1, title: 'Canlƒ±larƒ±n Ortak √ñzellikleri', youtubeId: 'UqXVgAmqBOs', duration: '16:00' },
                    { id: 2, title: 'H√ºcre Yapƒ±sƒ±', youtubeId: 'UqXVgAmqBOs', duration: '20:00' }
                ]
            }
        };

        // Topic names mapping - 2025 YKS m√ºfredatƒ±na g√∂re g√ºncel konu listesi
        const TOPIC_NAMES = {
            // TYT MATEMATƒ∞K
            'mat': {
                1: 'Temel Kavramlar', 2: 'Sayƒ± Basamaklarƒ±', 3: 'B√∂lme ve B√∂l√ºnebilme',
                4: 'EBOB - EKOK', 5: 'Rasyonel Sayƒ±lar', 6: 'Basit E≈üitsizlikler',
                7: 'Mutlak Deƒüer', 8: '√úsl√º Sayƒ±lar', 9: 'K√∂kl√º Sayƒ±lar',
                10: '√áarpanlara Ayƒ±rma', 11: 'Oran - Orantƒ±', 12: 'Denklem √á√∂zme',
                13: 'Problemler', 14: 'K√ºmeler', 15: 'Mantƒ±k',
                16: 'Fonksiyonlar', 17: 'Polinomlar', 18: 'ƒ∞kinci Dereceden Denklemler',
                19: 'Perm√ºtasyon ve Kombinasyon', 20: 'Olasƒ±lƒ±k', 21: 'Veri ve ƒ∞statistik'
            },
            // TYT GEOMETRƒ∞
            'geo': {
                1: 'Temel Kavramlar ve A√ßƒ±lar', 2: '√ú√ßgenler', 3: 'Dik √ú√ßgen ve Trigonometri',
                4: 'D√∂rtgenler', 5: '√áokgenler', 6: '√áember ve Daire',
                7: 'Katƒ± Cisimler', 8: 'Analitik Geometri Temelleri'
            },
            // TYT T√úRK√áE
            'trk': {
                1: 'S√∂zc√ºkte Anlam', 2: 'C√ºmlede Anlam', 3: 'Paragrafta Anlam',
                4: 'Ses Bilgisi', 5: 'S√∂zc√ºk Yapƒ±sƒ±', 6: 'S√∂zc√ºk T√ºrleri',
                7: 'C√ºmlenin √ñƒüeleri', 8: 'C√ºmle T√ºrleri', 9: 'Anlatƒ±m Bozukluklarƒ±',
                10: 'Yazƒ±m Kurallarƒ±', 11: 'Noktalama ƒ∞≈üaretleri'
            },
            // TYT Fƒ∞Zƒ∞K
            'fiz': {
                1: 'Fizik Bilimine Giri≈ü', 2: 'Madde ve √ñzellikleri', 3: 'Basƒ±n√ß ve Kaldƒ±rma Kuvveti',
                4: 'Hareket ve Kuvvet', 5: 'ƒ∞≈ü, G√º√ß ve Enerji', 6: 'Isƒ±, Sƒ±caklƒ±k ve Genle≈üme',
                7: 'Elektrostatik', 8: 'Elektrik Akƒ±mƒ± ve Devreler', 9: 'Manyetizma',
                10: 'Dalgalar', 11: 'Optik'
            },
            // TYT Kƒ∞MYA
            'kim': {
                1: 'Kimya Bilimi ve G√ºvenlik', 2: 'Atom Modelleri ve Yapƒ±sƒ±', 3: 'Periyodik Sistem',
                4: 'Kimyasal T√ºrler Arasƒ± Etkile≈üimler', 5: 'Maddenin Halleri', 6: 'Karƒ±≈üƒ±mlar ve √á√∂zeltiler',
                7: 'Asitler, Bazlar ve Tuzlar', 8: 'Kimyanƒ±n Temel Kanunlarƒ±', 9: 'Mol Kavramƒ± ve Hesaplamalar',
                10: 'Kimya Her Yerde'
            },
            // TYT Bƒ∞YOLOJƒ∞
            'bio': {
                1: 'Canlƒ±larƒ±n Ortak √ñzellikleri', 2: 'Canlƒ±lardaki Temel Bile≈üikler', 3: 'H√ºcre ve Organeller',
                4: 'Canlƒ±larƒ±n Sƒ±nƒ±flandƒ±rƒ±lmasƒ±', 5: 'Mitoz ve E≈üeysiz √úreme', 6: 'Mayoz ve E≈üeyli √úreme',
                7: 'Kalƒ±tƒ±m (Mendel Genetiƒüi)', 8: 'Ekosistem ve Madde D√∂ng√ºleri', 9: '√áevre Sorunlarƒ±'
            },
            // TYT TARƒ∞H
            'tar': {
                1: 'Tarih Bilimi', 2: 'ƒ∞lk √áaƒü Uygarlƒ±klarƒ±', 3: 'ƒ∞lk T√ºrk Devletleri',
                4: 'ƒ∞slam Tarihi ve T√ºrkler', 5: 'T√ºrkiye Tarihi (Sel√ßuklu)', 6: 'Osmanlƒ± Kurulu≈ü D√∂nemi'
            },
            // TYT COƒûRAFYA
            'cog': {
                1: 'Coƒürafya Bilimi ve Harita', 2: 'D√ºnya\'nƒ±n ≈ûekli ve Hareketleri', 3: 'ƒ∞klim Bilgisi',
                4: 'T√ºrkiye\'nin ƒ∞klimi', 5: 'Yery√ºz√º ≈ûekilleri', 6: 'N√ºfus ve Yerle≈üme'
            },
            // TYT FELSEFE
            'fel': {
                1: 'Felsefeye Giri≈ü', 2: 'Bilgi Felsefesi', 3: 'Varlƒ±k Felsefesi',
                4: 'Ahlak Felsefesi', 5: 'Din Felsefesi'
            },
            // TYT Dƒ∞N K√úLT√úR√ú
            'din': {
                1: 'ƒ∞slam ve ƒ∞badet', 2: 'Hz. Muhammed\'in Hayatƒ±', 3: 'Kur\'an ve Yorumlanmasƒ±',
                4: 'Din ve Hayat', 5: 'Ya≈üayan Dinler'
            },
            // AYT MATEMATƒ∞K
            'ayt-mat': {
                1: 'Fonksiyonlar (ƒ∞leri)', 2: 'Polinomlar', 3: 'ƒ∞kinci Dereceden Denklemler',
                4: 'Parabol', 5: 'Karma≈üƒ±k Sayƒ±lar', 6: 'ƒ∞kinci Dereceden E≈üitsizlikler',
                7: 'Trigonometri', 8: 'Toplam - √áarpƒ±m Sembolleri', 9: 'Diziler',
                10: 'Logaritma', 11: 'Limit ve S√ºreklilik', 12: 'T√ºrev',
                13: 'T√ºrev Uygulamalarƒ±', 14: 'ƒ∞ntegral', 15: 'ƒ∞ntegral Uygulamalarƒ±'
            },
            // AYT GEOMETRƒ∞
            'ayt-geo': {
                1: '√ú√ßgenlerde E≈ülik ve Benzerlik', 2: '√ú√ßgende Alan', 3: '√áemberin Analitik ƒ∞ncelemesi',
                4: 'D√∂rtgenlerin Alanlarƒ±', 5: 'Katƒ± Cisimlerin Hacimleri', 6: 'Analitik Geometri'
            },
            // AYT Fƒ∞Zƒ∞K
            'ayt-fiz': {
                1: 'Vekt√∂rler', 2: 'Baƒüƒ±l Hareket', 3: 'Newton Hareket Yasalarƒ± (ƒ∞leri)',
                4: 'ƒ∞≈ü, Enerji ve G√º√ß (ƒ∞leri)', 5: 'ƒ∞mpuls ve Momentum', 6: 'Tork ve Denge',
                7: 'Basit Harmonik Hareket', 8: 'Dalga Mekaniƒüi', 9: 'Elektrik Alan ve Potansiyel',
                10: 'Manyetik Alan ve Kuvvet', 11: 'Elektromanyetik ƒ∞nd√ºksiyon', 12: 'Alternatif Akƒ±m',
                13: 'Atom Fiziƒüine Giri≈ü', 14: 'Modern Fizik'
            },
            // AYT Kƒ∞MYA
            'ayt-kim': {
                1: 'Kimyasal Tepkimelerde Enerji', 2: 'Tepkime Hƒ±zlarƒ±', 3: 'Kimyasal Denge',
                4: '√á√∂z√ºn√ºrl√ºk Dengesi', 5: 'Asit-Baz Dengesi ve pH', 6: 'Elektrokimya',
                7: 'Organik Kimyaya Giri≈ü', 8: 'Hidrokarbonlar', 9: 'Fonksiyonel Gruplar',
                10: 'Organik Tepkimeler', 11: 'Polimerler', 12: 'Enerji Kaynaklarƒ±'
            },
            // AYT Bƒ∞YOLOJƒ∞
            'ayt-bio': {
                1: 'N√ºkleik Asitler ve Protein Sentezi', 2: 'Enerji D√∂n√º≈ü√ºmleri', 3: 'Sinir Sistemi',
                4: 'Endokrin Sistem', 5: 'Duyu Organlarƒ±', 6: 'Destek ve Hareket',
                7: 'Sindirim Sistemi', 8: 'Dola≈üƒ±m ve Baƒüƒ±≈üƒ±klƒ±k', 9: 'Solunum Sistemi',
                10: 'Bo≈üaltƒ±m Sistemi', 11: '√úreme Sistemi', 12: 'Pop√ºlasyon Ekolojisi',
                13: 'Genetik M√ºhendisliƒüi'
            },
            // AYT EDEBƒ∞YAT
            'edeb': {
                1: 'Edebiyata Giri≈ü', 2: '≈ûiir Bilgisi', 3: 'Edebi Akƒ±mlar',
                4: 'ƒ∞slamiyet √ñncesi T√ºrk Edebiyatƒ±', 5: 'Divan Edebiyatƒ±', 6: 'Halk Edebiyatƒ±',
                7: 'Tanzimat Edebiyatƒ±', 8: 'Servetif√ºnun Edebiyatƒ±', 9: 'Fecr-i Ati',
                10: 'Milli Edebiyat', 11: 'Cumhuriyet D√∂nemi'
            },
            // AYT TARƒ∞H-1
            'ayt-tar1': {
                1: 'Osmanlƒ± K√ºlt√ºr ve Medeniyeti', 2: 'Osmanlƒ± Duraklama D√∂nemi',
                3: 'Osmanlƒ± Gerileme D√∂nemi', 4: 'Osmanlƒ± Daƒüƒ±lma D√∂nemi',
                5: 'Kurtulu≈ü Sava≈üƒ± Hazƒ±rlƒ±k', 6: 'Kurtulu≈ü Sava≈üƒ± Muharebeleri',
                7: 'Atat√ºrk ƒ∞lkeleri ve ƒ∞nkƒ±laplar'
            },
            // AYT TARƒ∞H-2
            'ayt-tar2': {
                1: '19. Y√ºzyƒ±lda Avrupa', 2: 'I. D√ºnya Sava≈üƒ±', 3: 'ƒ∞ki Sava≈ü Arasƒ± D√∂nem',
                4: 'II. D√ºnya Sava≈üƒ±', 5: 'Soƒüuk Sava≈ü D√∂nemi', 6: 'Yumu≈üama D√∂nemi',
                7: 'SSCB\'nin Daƒüƒ±lmasƒ±', 8: 'K√ºreselle≈üen D√ºnya'
            },
            // AYT COƒûRAFYA
            'ayt-cog': {
                1: 'Doƒüal Sistemler', 2: 'Be≈üeri Sistemler', 3: 'T√ºrkiye\'nin B√∂lgeleri',
                4: 'Ekonomik Coƒürafya', 5: 'K√ºresel B√∂lgeler ve √úlkeler', 6: '√áevre ve Toplum',
                7: 'T√ºrkiye Ekonomik Coƒürafyasƒ±'
            },
            // AYT FELSEFE GRUBU
            'ayt-fel': {
                1: 'Psikoloji', 2: 'Sosyoloji', 3: 'Mantƒ±k', 4: 'Felsefe Tarihi'
            }
        };

        // Course names mapping - all TYT and AYT courses
        const COURSE_NAMES = {
            // TYT Courses
            'mat': 'Matematik',
            'geo': 'Geometri',
            'trk': 'T√ºrk√ße',
            'fiz': 'Fizik',
            'kim': 'Kimya',
            'bio': 'Biyoloji',
            'tar': 'Tarih',
            'cog': 'Coƒürafya',
            'fel': 'Felsefe',
            'din': 'Din K√ºlt√ºr√º',
            // AYT Courses
            'ayt-mat': 'AYT Matematik',
            'ayt-geo': 'AYT Geometri',
            'ayt-fiz': 'AYT Fizik',
            'ayt-kim': 'AYT Kimya',
            'ayt-bio': 'AYT Biyoloji',
            'edeb': 'Edebiyat',
            'ayt-tar1': 'Tarih-1',
            'ayt-tar2': 'Tarih-2',
            'ayt-cog': 'AYT Coƒürafya',
            'ayt-fel': 'Felsefe Grubu'
        };

        // =====================================================
        // END OF VIDEO DATA CONFIGURATION
        // =====================================================

        // Check authentication
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        if (!currentUser || !currentUser.loggedIn) {
            window.location.href = 'login.html';
        }

        // Get URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const category = urlParams.get('category') || 'tyt';
        const courseId = urlParams.get('course') || 'mat';
        const topicId = parseInt(urlParams.get('topic')) || 1;
        let currentVideoIndex = parseInt(urlParams.get('video')) || 0;

        // Player state
        let isPlaying = false;
        let hasError = false;
        let videoStarted = false;

        // Get videos for current topic - checks admin data first, then falls back to VIDEO_CONFIG
        function getTopicVideos() {
            // First try to get videos from admin panel
            const adminVideos = JSON.parse(localStorage.getItem('adminVideos')) || [];
            const topicVideos = adminVideos.filter(v =>
                v.course === courseId && v.topicId === topicId
            );

            if (topicVideos.length > 0) {
                console.log('[Videos] Using admin videos:', topicVideos.length);
                return topicVideos.map((v, index) => ({
                    id: index + 1,
                    title: v.title,
                    youtubeId: v.youtubeId,
                    duration: v.duration || '10:00'
                }));
            }

            // Fall back to VIDEO_CONFIG
            const courseVideos = VIDEO_CONFIG[courseId] || VIDEO_CONFIG['mat'];
            return courseVideos[topicId] || courseVideos[1] || [];
        }

        // VBO tracking - YouTube IFrame API based
        let vboProgress = {};
        let vboTimer = null;
        let watchedSeconds = 0;
        let lastPosition = 0;
        let player = null;
        let playerReady = false;

        function loadVBO() {
            const saved = localStorage.getItem(`vbo_${currentUser.email}`);
            vboProgress = saved ? JSON.parse(saved) : {};

            // Also load watched seconds for current video
            const watchedData = localStorage.getItem(`vboWatched_${currentUser.email}`);
            if (watchedData) {
                const parsed = JSON.parse(watchedData);
                const videos = getTopicVideos();
                const currentVideo = videos[currentVideoIndex];
                if (currentVideo) {
                    const key = `${courseId}_${topicId}_${currentVideo.id}`;
                    watchedSeconds = parsed[key] || 0;
                }
            }
        }

        function saveVBO() {
            localStorage.setItem(`vbo_${currentUser.email}`, JSON.stringify(vboProgress));
        }

        function saveWatchedSeconds() {
            const videos = getTopicVideos();
            const currentVideo = videos[currentVideoIndex];
            if (!currentVideo) return;

            const watchedData = JSON.parse(localStorage.getItem(`vboWatched_${currentUser.email}`) || '{}');
            const key = `${courseId}_${topicId}_${currentVideo.id}`;
            watchedData[key] = watchedSeconds;
            localStorage.setItem(`vboWatched_${currentUser.email}`, JSON.stringify(watchedData));
        }

        function getVideoVBO(videoId) {
            const key = `${courseId}_${topicId}_${videoId}`;
            return vboProgress[key] || 0;
        }

        function setVideoVBO(videoId, percent) {
            const key = `${courseId}_${topicId}_${videoId}`;
            vboProgress[key] = Math.min(100, Math.max(vboProgress[key] || 0, percent));
            saveVBO();
            updateVBODisplay();
        }

        function updateVBODisplay() {
            const videos = getTopicVideos();
            const currentVideo = videos[currentVideoIndex];
            if (!currentVideo) return;

            const vbo = getVideoVBO(currentVideo.id);
            document.getElementById('vboPercent').textContent = `%${Math.round(vbo)}`;
            document.getElementById('vboFill').style.width = `${vbo}%`;

            if (vbo >= 80) {
                document.getElementById('vboFill').classList.add('vbo-complete');
                document.getElementById('vboHint').textContent = '‚úì Bu video tamamlandƒ±!';
                document.getElementById('completeBtn').style.display = 'none';
            } else {
                document.getElementById('vboFill').classList.remove('vbo-complete');
                document.getElementById('vboHint').textContent = 'Videoyu izledik√ße VBO oranƒ±nƒ±z artacaktƒ±r. %80 ve √ºzeri tamamlanmƒ±≈ü sayƒ±lƒ±r.';
                document.getElementById('completeBtn').style.display = 'inline-flex';
            }
        }

        // Start VBO tracking - Uses YouTube API for real tracking
        function startVBOTracking() {
            if (vboTimer) return; // Already tracking
            if (hasError) return; // Don't track on error
            if (!player || !playerReady) {
                console.log('[VBO] Player not ready, using fallback tracking');
                startFallbackVBOTracking();
                return;
            }

            console.log('[VBO] Started YouTube API tracking');
            lastPosition = player.getCurrentTime() || 0;

            vboTimer = setInterval(() => {
                if (!player || !playerReady) return;

                const videos = getTopicVideos();
                const currentVideo = videos[currentVideoIndex];
                if (!currentVideo) return;

                // Check if document is visible (anti-cheat)
                if (document.visibilityState !== 'visible') {
                    console.log('[VBO] Tab not visible, pausing tracking');
                    return;
                }

                // Get current position and duration
                const currentPos = player.getCurrentTime();
                const duration = player.getDuration();
                const playbackRate = player.getPlaybackRate();

                if (!duration || duration <= 0) return;

                const delta = currentPos - lastPosition;

                // Anti-cheat: Only count if progressing normally (0.5 - 2.0 seconds per interval)
                // Also check playback rate isn't too fast
                if (delta > 0.5 && delta < 2.5 && playbackRate <= 1.5) {
                    watchedSeconds += delta;
                    saveWatchedSeconds();

                    // Calculate VBO based on real watched time vs duration
                    const newVBO = Math.min(100, Math.round((watchedSeconds / duration) * 100));
                    setVideoVBO(currentVideo.id, newVBO);

                    console.log(`[VBO] Watched: ${watchedSeconds.toFixed(1)}s / ${duration.toFixed(1)}s = ${newVBO}%`);
                }

                lastPosition = currentPos;
            }, 1000);
        }

        // Fallback VBO tracking for when YouTube API is not available
        function startFallbackVBOTracking() {
            if (vboTimer) return;

            console.log('[VBO] Using fallback time-based tracking');
            const startTime = Date.now();

            vboTimer = setInterval(() => {
                if (document.visibilityState !== 'visible') return;

                const videos = getTopicVideos();
                const currentVideo = videos[currentVideoIndex];
                if (!currentVideo) return;

                // Parse duration from metadata (e.g., "15:30")
                const durationStr = currentVideo.duration || '10:00';
                const parts = durationStr.split(':');
                const durationSeconds = (parseInt(parts[0]) * 60) + parseInt(parts[1] || 0);

                const elapsed = (Date.now() - startTime) / 1000;
                watchedSeconds += 1;

                const newVBO = Math.min(100, Math.round((watchedSeconds / durationSeconds) * 100));
                setVideoVBO(currentVideo.id, newVBO);
            }, 1000);
        }

        function stopVBOTracking() {
            if (vboTimer) {
                console.log('[VBO] Stopped tracking');
                clearInterval(vboTimer);
                vboTimer = null;
                saveWatchedSeconds();
            }
            isPlaying = false;
        }

        // Load YouTube IFrame API
        let ytApiLoaded = false;
        let pendingVideoId = null;

        function loadYouTubeAPI() {
            if (ytApiLoaded) return Promise.resolve();

            return new Promise((resolve) => {
                // Check if API is already available
                if (typeof YT !== 'undefined' && YT.Player) {
                    ytApiLoaded = true;
                    resolve();
                    return;
                }

                // Load the API script
                const tag = document.createElement('script');
                tag.src = 'https://www.youtube.com/iframe_api';
                const firstScriptTag = document.getElementsByTagName('script')[0];
                firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

                // Wait for API to be ready
                window.onYouTubeIframeAPIReady = function () {
                    console.log('[YouTube API] Ready');
                    ytApiLoaded = true;
                    resolve();

                    // If there's a pending video, create the player
                    if (pendingVideoId) {
                        createYTPlayer(pendingVideoId);
                        pendingVideoId = null;
                    }
                };
            });
        }

        // Create YouTube Player using IFrame API
        function createYTPlayer(youtubeId) {
            const container = document.getElementById('playerContainer');

            // Create player div and custom controls
            container.innerHTML = `
                <div id="ytPlayer"></div>
                <div class="interaction-blocker" id="interactionBlocker"></div>
                <div class="custom-controls" id="customControls">
                    <button class="ctrl-btn play-btn" id="ctrlPlayBtn" onclick="togglePlayPause()">‚ñ∂Ô∏è</button>
                    <div class="volume-control">
                        <button class="ctrl-btn" id="ctrlMuteBtn" onclick="toggleMute()">üîä</button>
                        <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="100" onchange="setVolume(this.value)">
                    </div>
                    <span class="time-display" id="timeDisplay">0:00 / 0:00</span>
                    <div class="progress-bar-container">
                        <div class="progress-bar-fill" id="progressBarFill"></div>
                    </div>
                    <div class="speed-control">
                        <button class="speed-btn" id="speedBtn" onclick="toggleSpeedMenu()">1x</button>
                        <div class="speed-menu" id="speedMenu">
                            <button class="speed-option" onclick="setPlaybackSpeed(0.5)">0.5x</button>
                            <button class="speed-option" onclick="setPlaybackSpeed(0.75)">0.75x</button>
                            <button class="speed-option active" onclick="setPlaybackSpeed(1)">1x</button>
                            <button class="speed-option" onclick="setPlaybackSpeed(1.25)">1.25x</button>
                            <button class="speed-option" onclick="setPlaybackSpeed(1.5)">1.5x</button>
                        </div>
                    </div>
                    <button class="ctrl-btn" onclick="toggleFullscreen()">‚õ∂</button>
                </div>
            `;

            // Reset watched seconds for new video
            const videos = getTopicVideos();
            const currentVideo = videos[currentVideoIndex];
            if (currentVideo) {
                const watchedData = JSON.parse(localStorage.getItem(`vboWatched_${currentUser.email}`) || '{}');
                const key = `${courseId}_${topicId}_${currentVideo.id}`;
                watchedSeconds = watchedData[key] || 0;
                lastPosition = 0;
            }

            playerReady = false;
            currentPlaybackRate = 1;

            player = new YT.Player('ytPlayer', {
                videoId: youtubeId,
                playerVars: {
                    'controls': 0,        // Hide YouTube controls
                    'disablekb': 1,       // Disable keyboard controls
                    'rel': 0,
                    'modestbranding': 1,
                    'playsinline': 1,
                    'enablejsapi': 1,
                    'origin': window.location.origin,
                    'fs': 0               // Disable YouTube fullscreen button
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange,
                    'onError': onPlayerError
                }
            });
        }

        // YouTube Player event handlers
        function onPlayerReady(event) {
            console.log('[YouTube API] Player ready');
            playerReady = true;

            // Hide placeholder
            const placeholder = document.getElementById('videoPlaceholder');
            if (placeholder) placeholder.style.display = 'none';

            // Start time display update
            startTimeUpdateInterval();

            // Show custom controls
            const controls = document.getElementById('customControls');
            if (controls) controls.classList.add('visible');

            // Remove play overlay after short delay
            setTimeout(() => {
                removePlayOverlay();
            }, 500);
        }

        function onPlayerStateChange(event) {
            console.log('[YouTube API] State changed:', event.data);

            switch (event.data) {
                case YT.PlayerState.PLAYING: // 1
                    if (!videoStarted) {
                        videoStarted = true;
                        removePlayOverlay();
                    }
                    isPlaying = true;
                    hasError = false;
                    startVBOTracking();
                    break;

                case YT.PlayerState.PAUSED: // 2
                    isPlaying = false;
                    stopVBOTracking();
                    break;

                case YT.PlayerState.ENDED: // 0
                    isPlaying = false;
                    stopVBOTracking();
                    // Mark video as 100% complete
                    const videos = getTopicVideos();
                    const currentVideo = videos[currentVideoIndex];
                    if (currentVideo) {
                        watchedSeconds = player.getDuration();
                        setVideoVBO(currentVideo.id, 100);
                        updateTopicProgress();
                        renderVideoList();
                    }
                    break;

                case YT.PlayerState.BUFFERING: // 3
                    // Don't count buffering time
                    break;
            }
        }

        function onPlayerError(event) {
            console.error('[YouTube API] Error:', event.data);
            hasError = true;
            stopVBOTracking();

            const errorMessages = {
                2: 'Ge√ßersiz video ID',
                5: 'HTML5 oynatƒ±cƒ± hatasƒ±',
                100: 'Video bulunamadƒ± veya kaldƒ±rƒ±lmƒ±≈ü',
                101: 'Video g√∂mme izni yok',
                150: 'Video g√∂mme izni yok'
            };

            showErrorOverlay(event.data, errorMessages[event.data] || 'Bilinmeyen hata');
        }

        // Create YouTube iframe with HTML embedding (fallback for file:// protocol)
        function createVideoIframe(youtubeId) {
            // Check if we're on HTTP/HTTPS (required for YouTube API)
            const isHttpProtocol = window.location.protocol === 'http:' || window.location.protocol === 'https:';

            if (isHttpProtocol) {
                // Use YouTube IFrame API for proper tracking
                console.log('[Video] Using YouTube IFrame API');

                if (ytApiLoaded) {
                    createYTPlayer(youtubeId);
                } else {
                    pendingVideoId = youtubeId;
                    loadYouTubeAPI();

                    // Show loading state
                    const container = document.getElementById('playerContainer');
                    container.innerHTML = '<div id="ytPlayer" style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;"><div style="text-align:center;"><div style="font-size:48px;">‚è≥</div><div style="color:#94a3b8;margin-top:12px;">YouTube API y√ºkleniyor...</div></div></div>';
                }
                return;
            }

            // Fallback: Simple iframe for file:// protocol
            console.log('[Video] Using simple iframe (file:// protocol)');
            const container = document.getElementById('playerContainer');

            // Clear previous content
            container.innerHTML = '';

            const iframe = document.createElement('iframe');
            iframe.id = 'youtubePlayer';

            const embedUrl = `https://www.youtube.com/embed/${youtubeId}?rel=0&modestbranding=1&playsinline=1`;
            iframe.src = embedUrl;

            iframe.setAttribute('allow', 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share');
            iframe.setAttribute('allowfullscreen', 'true');
            iframe.setAttribute('frameborder', '0');
            iframe.setAttribute('referrerpolicy', 'strict-origin-when-cross-origin');
            iframe.style.width = '100%';
            iframe.style.height = '100%';
            iframe.style.border = 'none';

            // Handle iframe load and errors
            iframe.onload = function () {
                console.log('[Video] Iframe loaded successfully');
                const placeholder = document.getElementById('videoPlaceholder');
                if (placeholder) placeholder.style.display = 'none';

                setTimeout(() => {
                    checkVideoError(youtubeId);
                }, 2000);
            };

            iframe.onerror = function () {
                console.error('[Video] Iframe load error');
                showErrorOverlay(153, 'Video y√ºklenirken bir hata olu≈ütu. Video ID\'yi kontrol edin.');
            };

            container.appendChild(iframe);

            // Add play overlay for VBO tracking
            addPlayOverlay();
        }


        // Add play overlay to track when user starts watching
        function addPlayOverlay() {
            const container = document.getElementById('videoContainer');

            // Remove existing overlay
            removePlayOverlay();

            const overlay = document.createElement('div');
            overlay.className = 'play-overlay';
            overlay.id = 'playOverlay';
            overlay.innerHTML = `
                <div class="play-overlay-icon">‚ñ∂Ô∏è</div>
                <div class="play-overlay-text">Videoyu ƒ∞zlemeye Ba≈üla</div>
            `;
            overlay.onclick = startWatching;

            container.appendChild(overlay);
        }

        function removePlayOverlay() {
            const overlay = document.getElementById('playOverlay');
            if (overlay) {
                overlay.remove();
            }
        }

        // Start watching - called when user clicks play overlay
        function startWatching() {
            removePlayOverlay();
            videoStarted = true;
            isPlaying = true;
            hasError = false;

            // Start VBO tracking now that user has initiated playback
            startVBOTracking();

            // Try to play the video via postMessage
            const iframe = document.getElementById('youtubePlayer');
            if (iframe && iframe.contentWindow) {
                iframe.contentWindow.postMessage('{"event":"command","func":"playVideo","args":""}', '*');
            }
        }

        // Listen for messages from YouTube iframe (player state changes)
        window.addEventListener('message', function (event) {
            // Only accept messages from YouTube
            if (event.origin !== 'https://www.youtube.com') return;

            try {
                const data = JSON.parse(event.data);

                // Handle player state changes
                if (data.event === 'onStateChange') {
                    switch (data.info) {
                        case 1: // PLAYING
                            if (!videoStarted) {
                                videoStarted = true;
                                removePlayOverlay();
                            }
                            isPlaying = true;
                            hasError = false;
                            startVBOTracking();
                            break;
                        case 2: // PAUSED
                            isPlaying = false;
                            stopVBOTracking();
                            break;
                        case 0: // ENDED
                            isPlaying = false;
                            stopVBOTracking();
                            // Mark as complete
                            const videos = getTopicVideos();
                            const currentVideo = videos[currentVideoIndex];
                            if (currentVideo) {
                                setVideoVBO(currentVideo.id, 100);
                                updateTopicProgress();
                                renderVideoList();
                            }
                            break;
                    }
                }

                // Handle errors
                if (data.event === 'onError') {
                    hasError = true;
                    stopVBOTracking();
                    const errorMessages = {
                        2: 'Ge√ßersiz video ID',
                        5: 'HTML5 oynatƒ±cƒ± hatasƒ±',
                        100: 'Video bulunamadƒ± veya kaldƒ±rƒ±lmƒ±≈ü',
                        101: 'Video g√∂mme izni yok',
                        150: 'Video g√∂mme izni yok'
                    };
                    showErrorOverlay(data.info, errorMessages[data.info] || 'Bilinmeyen hata');
                }
            } catch (e) {
                // Not a JSON message, ignore
            }
        });

        // Show error overlay
        function showErrorOverlay(errorCode, errorMessage) {
            const container = document.getElementById('videoContainer');

            // Remove existing error overlay
            hideErrorOverlay();
            removePlayOverlay();

            const errorOverlay = document.createElement('div');
            errorOverlay.className = 'video-error-overlay';
            errorOverlay.id = 'videoErrorOverlay';
            errorOverlay.innerHTML = `
                <div class="video-error-icon">‚ö†Ô∏è</div>
                <div class="video-error-title">Video Y√ºklenemedi</div>
                <div class="video-error-message">
                    ${errorMessage || 'Video oynatƒ±lƒ±rken bir hata olu≈ütu.'}<br>
                    <small style="opacity: 0.7;">Hata Kodu: ${errorCode}</small>
                </div>
                <button class="video-error-btn" onclick="retryVideo()">
                    üîÑ Tekrar Dene
                </button>
            `;

            container.appendChild(errorOverlay);
        }

        // Hide error overlay
        function hideErrorOverlay() {
            const existingOverlay = document.getElementById('videoErrorOverlay');
            if (existingOverlay) {
                existingOverlay.remove();
            }
        }

        // Check if video has error (Hata 153 kontrol√º)
        function checkVideoError(videoId) {
            const iframe = document.getElementById('youtubePlayer');
            if (!iframe) return;

            // Try to access iframe content (may fail due to CORS, that's OK)
            try {
                // If we can't access iframe content, check by trying to play
                // If video has error 153, it won't respond to play commands
                const testPlay = setTimeout(() => {
                    // If video doesn't start playing after 3 seconds, might be error
                    if (!isPlaying && !hasError) {
                        console.warn('[Video] Possible error - video not playing');
                        // Don't show error immediately, user might click play
                    }
                }, 3000);
            } catch (e) {
                // CORS error is normal, ignore
                console.log('[Video] Cannot check iframe content (CORS) - this is normal');
            }
        }

        // Retry loading video
        function retryVideo() {
            hasError = false;
            videoStarted = false;
            hideErrorOverlay();
            loadVideo(currentVideoIndex);
        }

        // Mark video as complete
        function markComplete() {
            const videos = getTopicVideos();
            const currentVideo = videos[currentVideoIndex];
            if (!currentVideo) return;

            setVideoVBO(currentVideo.id, 100);
            updateTopicProgress();
            renderVideoList();
            updateStats();
        }

        // Update topic progress
        function updateTopicProgress() {
            const videos = getTopicVideos();
            let completed = 0;

            videos.forEach(video => {
                if (getVideoVBO(video.id) >= 80) completed++;
            });

            const percent = Math.round((completed / videos.length) * 100);

            document.getElementById('progressLabel').textContent = `${completed}/${videos.length} Video`;
            document.getElementById('progressPercent').textContent = `%${percent}`;
            document.getElementById('topicProgressFill').style.width = `${percent}%`;

            if (completed === videos.length) {
                document.getElementById('topicStatus').innerHTML = '‚úÖ T√ºm videolar tamamlandƒ±! <strong>Teste hazƒ±rsƒ±nƒ±z!</strong>';
                document.getElementById('testBtn').classList.add('btn-primary');
                document.getElementById('testBtn').classList.remove('btn-outline');
            }

            // Save topic progress
            const topicProgress = JSON.parse(localStorage.getItem(`topicProgress_${currentUser.email}`)) || {};
            topicProgress[`${courseId}_${topicId}`] = completed === videos.length ? 'completed' : completed > 0 ? 'in-progress' : 'not-started';
            localStorage.setItem(`topicProgress_${currentUser.email}`, JSON.stringify(topicProgress));
        }

        // Update user stats
        function updateStats() {
            const stats = JSON.parse(localStorage.getItem(`stats_${currentUser.email}`)) || {
                videosWatched: 0,
                testsCompleted: 0,
                vboPercent: 0,
                streakDays: 0
            };

            // Count completed videos
            let totalVBO = 0;
            let completedVideos = 0;
            let videoCount = 0;

            Object.entries(vboProgress).forEach(([key, value]) => {
                videoCount++;
                totalVBO += value;
                if (value >= 80) completedVideos++;
            });

            stats.videosWatched = completedVideos;
            stats.vboPercent = videoCount > 0 ? Math.round(totalVBO / videoCount) : 0;

            localStorage.setItem(`stats_${currentUser.email}`, JSON.stringify(stats));
        }

        // Load video using HTML iframe
        function loadVideo(index) {
            stopVBOTracking();
            hasError = false;
            videoStarted = false;
            hideErrorOverlay();
            currentVideoIndex = index;

            const videos = getTopicVideos();
            const video = videos[index];

            if (!video) return;

            // Update URL
            history.replaceState(null, '', `?category=${category}&course=${courseId}&topic=${topicId}&video=${index}`);

            // Hide placeholder
            const placeholder = document.getElementById('videoPlaceholder');
            if (placeholder) placeholder.style.display = 'none';

            // Create iframe with video
            createVideoIframe(video.youtubeId);

            // Update info
            document.getElementById('videoTitle').textContent = video.title;
            document.getElementById('metaDuration').textContent = video.duration;
            document.getElementById('metaVideoNumber').textContent = index + 1;
            document.getElementById('metaTotalVideos').textContent = videos.length;

            // Update navigation buttons
            document.getElementById('prevBtn').disabled = index === 0;
            document.getElementById('nextBtn').disabled = index === videos.length - 1;

            // Update video list
            renderVideoList();

            // Update VBO display (NOT starting tracking - that happens on play)
            updateVBODisplay();
        }

        // Render video list
        function renderVideoList() {
            const videos = getTopicVideos();
            const list = document.getElementById('videoList');

            list.innerHTML = videos.map((video, index) => {
                const vbo = getVideoVBO(video.id);
                const isCompleted = vbo >= 80;
                const isActive = index === currentVideoIndex;

                return `
          <div class="video-item ${isActive ? 'active' : ''} ${isCompleted ? 'completed' : ''}" onclick="loadVideo(${index})">
            <div class="video-item-number">${isCompleted ? '‚úì' : index + 1}</div>
            <div class="video-item-info">
              <div class="video-item-title">${video.title}</div>
              <div class="video-item-duration">${video.duration}</div>
            </div>
            <span class="video-item-status">${isCompleted ? '‚úÖ' : isActive ? '‚ñ∂Ô∏è' : '‚≠ï'}</span>
          </div>
        `;
            }).join('');
        }

        // Navigation
        function prevVideo() {
            if (currentVideoIndex > 0) {
                loadVideo(currentVideoIndex - 1);
            }
        }

        function nextVideo() {
            const videos = getTopicVideos();
            if (currentVideoIndex < videos.length - 1) {
                loadVideo(currentVideoIndex + 1);
            }
        }

        function goToTest() {
            window.location.href = `test.html?category=${category}&course=${courseId}&topic=${topicId}`;
        }


        // =====================================================
        // CUSTOM VIDEO CONTROLS
        // =====================================================
        let currentPlaybackRate = 1;
        let timeUpdateInterval = null;
        let isMuted = false;

        function togglePlayPause() {
            if (!player || !playerReady) return;

            if (isPlaying) {
                player.pauseVideo();
                document.getElementById('ctrlPlayBtn').textContent = '‚ñ∂Ô∏è';
            } else {
                player.playVideo();
                document.getElementById('ctrlPlayBtn').textContent = '‚è∏Ô∏è';
            }
        }

        function toggleMute() {
            if (!player || !playerReady) return;

            if (isMuted) {
                player.unMute();
                document.getElementById('ctrlMuteBtn').textContent = 'üîä';
                document.getElementById('volumeSlider').value = player.getVolume();
            } else {
                player.mute();
                document.getElementById('ctrlMuteBtn').textContent = 'üîá';
            }
            isMuted = !isMuted;
        }

        function setVolume(value) {
            if (!player || !playerReady) return;

            player.setVolume(value);
            if (value == 0) {
                document.getElementById('ctrlMuteBtn').textContent = 'üîá';
                isMuted = true;
            } else {
                document.getElementById('ctrlMuteBtn').textContent = 'üîä';
                isMuted = false;
            }
        }

        function setPlaybackSpeed(rate) {
            if (!player || !playerReady) return;

            player.setPlaybackRate(rate);
            currentPlaybackRate = rate;
            document.getElementById('speedBtn').textContent = rate + 'x';

            // Update active state in menu
            document.querySelectorAll('.speed-option').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent === rate + 'x') {
                    btn.classList.add('active');
                }
            });

            // Close menu
            document.getElementById('speedMenu').classList.remove('show');

            console.log('[VBO] Playback speed changed to:', rate);
        }

        function toggleSpeedMenu() {
            const menu = document.getElementById('speedMenu');
            menu.classList.toggle('show');
        }

        function toggleFullscreen() {
            const container = document.getElementById('videoContainer');

            if (!document.fullscreenElement) {
                if (container.requestFullscreen) {
                    container.requestFullscreen();
                } else if (container.webkitRequestFullscreen) {
                    container.webkitRequestFullscreen();
                } else if (container.msRequestFullscreen) {
                    container.msRequestFullscreen();
                }
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function updateTimeDisplay() {
            if (!player || !playerReady) return;

            const currentTime = player.getCurrentTime() || 0;
            const duration = player.getDuration() || 0;

            document.getElementById('timeDisplay').textContent =
                `${formatTime(currentTime)} / ${formatTime(duration)}`;

            // Update progress bar
            const progress = duration > 0 ? (currentTime / duration) * 100 : 0;
            document.getElementById('progressBarFill').style.width = progress + '%';

            // Update play button icon
            const playBtn = document.getElementById('ctrlPlayBtn');
            if (playBtn) {
                playBtn.textContent = isPlaying ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è';
            }
        }

        function startTimeUpdateInterval() {
            if (timeUpdateInterval) clearInterval(timeUpdateInterval);
            timeUpdateInterval = setInterval(updateTimeDisplay, 500);
        }

        // Close speed menu when clicking outside
        document.addEventListener('click', function (e) {
            const speedMenu = document.getElementById('speedMenu');
            const speedBtn = document.getElementById('speedBtn');
            if (speedMenu && speedBtn && !speedMenu.contains(e.target) && !speedBtn.contains(e.target)) {
                speedMenu.classList.remove('show');
            }
        });

        // Initialize
        function init() {
            loadVBO();

            // Update breadcrumbs
            document.getElementById('breadcrumbCategory').textContent = category.toUpperCase();
            document.getElementById('breadcrumbCategory').href = `courses.html?category=${category}`;
            document.getElementById('breadcrumbCourse').textContent = COURSE_NAMES[courseId] || 'Ders';
            document.getElementById('breadcrumbCourse').href = `topics.html?category=${category}&course=${courseId}`;

            // Use nested TOPIC_NAMES lookup: courseId -> topicId
            const topicName = (TOPIC_NAMES[courseId] && TOPIC_NAMES[courseId][topicId]) || `Konu ${topicId}`;
            document.getElementById('breadcrumbTopic').textContent = topicName;

            document.getElementById('metaCourse').textContent = COURSE_NAMES[courseId] || 'Ders';
            document.getElementById('metaTopic').textContent = topicName;

            // Update back link
            document.getElementById('backToTopics').href = `topics.html?category=${category}&course=${courseId}`;
            document.getElementById('topicsLink').href = `topics.html?category=${category}&course=${courseId}`;

            // Load first video
            loadVideo(currentVideoIndex);
            updateTopicProgress();
            renderVideoList();
            updateVBODisplay();
        }

        // Wait for DOM to be ready
        document.addEventListener('DOMContentLoaded', function () {
            init();
        });

        // Cleanup on page leave
        window.addEventListener('beforeunload', () => {
            stopVBOTracking();
        });

        function logout() {
            stopVBOTracking();
            localStorage.removeItem('currentUser');
            window.location.href = 'login.html';
        }
    </script>
</body>

</html>