<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Konu Testi | YKS Hazƒ±rlƒ±k Platformu</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0a0f1a;
            --bg-secondary: #0f172a;
            --surface: #1e293b;
            --border: rgba(255, 255, 255, 0.08);
            --text: #f1f5f9;
            --text-muted: #94a3b8;
            --primary: #3b82f6;
            --secondary: #8b5cf6;
            --gradient: linear-gradient(135deg, var(--primary), var(--secondary));
            --success: #22c55e;
            --warning: #f59e0b;
            --error: #ef4444;
            --radius: 16px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
        }

        .bg-glow {
            position: fixed;
            width: 600px;
            height: 600px;
            border-radius: 50%;
            filter: blur(150px);
            opacity: 0.1;
            pointer-events: none;
            z-index: 0;
        }

        .bg-glow-1 {
            top: -200px;
            left: -100px;
            background: var(--primary);
        }

        .bg-glow-2 {
            bottom: -200px;
            right: -100px;
            background: var(--secondary);
        }

        .header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(10, 15, 26, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            padding: 16px 24px;
        }

        .header-content {
            max-width: 1000px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
            color: var(--text);
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--gradient);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .logo-text {
            font-size: 18px;
            font-weight: 700;
        }

        .test-timer {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: rgba(245, 158, 11, 0.15);
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            color: #fcd34d;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 18px;
            border-radius: 10px;
            font-weight: 500;
            font-size: 14px;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
            text-decoration: none;
            font-family: inherit;
        }

        .btn-outline {
            background: transparent;
            color: var(--text-muted);
            border: 1px solid var(--border);
        }

        .btn-outline:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text);
        }

        .btn-primary {
            background: var(--gradient);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.3);
        }

        .btn-success {
            background: rgba(34, 197, 94, 0.2);
            color: #86efac;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .btn-danger {
            background: rgba(239, 68, 68, 0.15);
            color: #fca5a5;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .main {
            max-width: 1000px;
            margin: 0 auto;
            padding: 32px 24px;
            position: relative;
            z-index: 1;
        }

        /* Test Info */
        .test-info {
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.06) 0%, rgba(255, 255, 255, 0.02) 100%);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 32px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 16px;
        }

        .test-info-left h1 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .test-meta {
            display: flex;
            gap: 20px;
            font-size: 14px;
            color: var(--text-muted);
        }

        .test-meta-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .test-progress {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .progress-circle {
            width: 60px;
            height: 60px;
            background: conic-gradient(var(--primary) var(--progress, 0%), rgba(255, 255, 255, 0.1) 0%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .progress-circle-inner {
            width: 48px;
            height: 48px;
            background: var(--bg);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
        }

        /* Question Card */
        .question-card {
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.06) 0%, rgba(255, 255, 255, 0.02) 100%);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 32px;
            margin-bottom: 24px;
        }

        .question-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .question-number {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .question-badge {
            width: 36px;
            height: 36px;
            background: var(--gradient);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 16px;
        }

        .question-label {
            font-size: 14px;
            color: var(--text-muted);
        }

        .question-status {
            padding: 6px 12px;
            border-radius: 100px;
            font-size: 12px;
            font-weight: 500;
        }

        .question-status.answered {
            background: rgba(34, 197, 94, 0.15);
            color: #86efac;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .question-status.unanswered {
            background: rgba(148, 163, 184, 0.15);
            color: var(--text-muted);
        }

        .question-text {
            font-size: 18px;
            line-height: 1.7;
            margin-bottom: 24px;
        }

        /* Options */
        .options-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px 20px;
            background: rgba(255, 255, 255, 0.03);
            border: 2px solid var(--border);
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .option:hover {
            background: rgba(255, 255, 255, 0.06);
            border-color: rgba(255, 255, 255, 0.15);
        }

        .option.selected {
            background: rgba(59, 130, 246, 0.1);
            border-color: var(--primary);
        }

        .option.correct {
            background: rgba(34, 197, 94, 0.15);
            border-color: var(--success);
        }

        .option.wrong {
            background: rgba(239, 68, 68, 0.15);
            border-color: var(--error);
        }

        .option-letter {
            width: 36px;
            height: 36px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 16px;
            flex-shrink: 0;
        }

        .option.selected .option-letter {
            background: var(--primary);
        }

        .option.correct .option-letter {
            background: var(--success);
        }

        .option.wrong .option-letter {
            background: var(--error);
        }

        .option-text {
            font-size: 15px;
            line-height: 1.5;
        }

        /* Navigation */
        .question-nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid var(--border);
        }

        .nav-buttons {
            display: flex;
            gap: 12px;
        }

        /* Question Navigator */
        .question-navigator {
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.06) 0%, rgba(255, 255, 255, 0.02) 100%);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 24px;
        }

        .navigator-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-muted);
        }

        .navigator-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .nav-item {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .nav-item.current {
            background: var(--gradient);
            border-color: transparent;
        }

        .nav-item.answered {
            background: rgba(34, 197, 94, 0.2);
            border-color: rgba(34, 197, 94, 0.3);
            color: #86efac;
        }

        /* Results */
        .results-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 24px;
        }

        .results-overlay.active {
            display: flex;
        }

        .results-card {
            width: 100%;
            max-width: 600px;
            background: linear-gradient(180deg, rgba(30, 41, 59, 1) 0%, rgba(15, 23, 42, 1) 100%);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 40px;
            text-align: center;
        }

        .results-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        .results-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .results-subtitle {
            font-size: 16px;
            color: var(--text-muted);
            margin-bottom: 32px;
        }

        .results-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 32px;
        }

        .result-stat {
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
        }

        .result-stat-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .result-stat-value.correct {
            color: var(--success);
        }

        .result-stat-value.wrong {
            color: var(--error);
        }

        .result-stat-value.empty {
            color: var(--warning);
        }

        .result-stat-label {
            font-size: 14px;
            color: var(--text-muted);
        }

        .results-net {
            padding: 20px;
            background: var(--gradient);
            border-radius: 16px;
            margin-bottom: 24px;
        }

        .net-label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 4px;
        }

        .net-value {
            font-size: 36px;
            font-weight: 800;
        }

        .results-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .results-actions .btn {
            padding: 14px 28px;
        }

        @media (max-width: 768px) {
            .test-info {
                flex-direction: column;
                text-align: center;
            }

            .results-stats {
                grid-template-columns: 1fr;
            }

            .question-nav {
                flex-direction: column;
                gap: 16px;
            }
        }
    </style>
</head>

<body>
    <div class="bg-glow bg-glow-1"></div>
    <div class="bg-glow bg-glow-2"></div>

    <header class="header">
        <div class="header-content">
            <div class="header-left">
                <a href="student_dashboard.html" class="logo">
                    <div class="logo-icon">üìö</div>
                    <span class="logo-text">SEBA Akademi</span>
                </a>
                <div class="test-timer">
                    ‚è±Ô∏è <span id="timer">10:00</span>
                </div>
            </div>
            <div class="header-right">
                <button class="btn btn-outline" onclick="confirmExit()">‚Üê Testi Bƒ±rak</button>
                <button class="btn btn-primary" onclick="finishTest()">‚úì Testi Bitir</button>
            </div>
        </div>
    </header>

    <main class="main">
        <!-- Test Info -->
        <div class="test-info">
            <div class="test-info-left">
                <h1 id="testTitle">üìù Konu Testi</h1>
                <div class="test-meta">
                    <span class="test-meta-item">üìö <span id="testCourse">Matematik</span></span>
                    <span class="test-meta-item">üìã <span id="testTopic">Temel Kavramlar</span></span>
                    <span class="test-meta-item">‚ùì <span id="questionCount">10</span> Soru</span>
                </div>
            </div>
            <div class="test-progress">
                <div class="progress-circle" id="progressCircle" style="--progress: 0%;">
                    <div class="progress-circle-inner" id="progressText">0/10</div>
                </div>
            </div>
        </div>

        <!-- Question Navigator -->
        <div class="question-navigator">
            <div class="navigator-title">Soru Navigasyonu</div>
            <div class="navigator-grid" id="navigatorGrid">
                <!-- Will be populated -->
            </div>
        </div>

        <!-- Question Card -->
        <div class="question-card" id="questionCard">
            <div class="question-header">
                <div class="question-number">
                    <div class="question-badge" id="questionBadge">1</div>
                    <span class="question-label">Soru <span id="currentQ">1</span>/<span id="totalQ">10</span></span>
                </div>
                <span class="question-status unanswered" id="questionStatus">Cevaplanmadƒ±</span>
            </div>
            <p class="question-text" id="questionText">Soru y√ºkleniyor...</p>
            <div class="options-list" id="optionsList">
                <!-- Options will be populated -->
            </div>
            <div class="question-nav">
                <div class="nav-buttons">
                    <button class="btn btn-outline" onclick="prevQuestion()" id="prevBtn">‚¨ÖÔ∏è √ñnceki</button>
                    <button class="btn btn-outline" onclick="nextQuestion()" id="nextBtn">Sonraki ‚û°Ô∏è</button>
                </div>
                <button class="btn btn-success" onclick="clearAnswer()">üóëÔ∏è Cevabƒ± Temizle</button>
            </div>
        </div>
    </main>

    <!-- Results Overlay -->
    <div class="results-overlay" id="resultsOverlay">
        <div class="results-card">
            <div class="results-icon" id="resultsIcon">üéâ</div>
            <h2 class="results-title" id="resultsTitle">Test Tamamlandƒ±!</h2>
            <p class="results-subtitle" id="resultsSubtitle">Tebrikler! Testi ba≈üarƒ±yla tamamladƒ±nƒ±z.</p>

            <div class="results-stats">
                <div class="result-stat">
                    <div class="result-stat-value correct" id="correctCount">0</div>
                    <div class="result-stat-label">Doƒüru</div>
                </div>
                <div class="result-stat">
                    <div class="result-stat-value wrong" id="wrongCount">0</div>
                    <div class="result-stat-label">Yanlƒ±≈ü</div>
                </div>
                <div class="result-stat">
                    <div class="result-stat-value empty" id="emptyCount">0</div>
                    <div class="result-stat-label">Bo≈ü</div>
                </div>
            </div>

            <div class="results-net">
                <div class="net-label">Net Puanƒ±nƒ±z</div>
                <div class="net-value" id="netScore">0.00</div>
            </div>

            <div class="results-actions">
                <button class="btn btn-outline" onclick="reviewAnswers()">üìã Cevaplarƒ± ƒ∞ncele</button>
                <button class="btn btn-primary" onclick="goBack()">‚Üê Konulara D√∂n</button>
            </div>
        </div>
    </div>

    <script>
        // Check authentication
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        if (!currentUser || !currentUser.loggedIn) {
            window.location.href = 'login.html';
        }

        // Get URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const category = urlParams.get('category') || 'tyt';
        const courseId = urlParams.get('course') || 'mat';
        const topicId = parseInt(urlParams.get('topic')) || 1;

        // Question bank for each topic
        const questionBank = {
            'mat': {
                1: [ // Temel Kavramlar
                    {
                        question: "24 sayƒ±sƒ±nƒ±n pozitif b√∂len sayƒ±sƒ± ka√ßtƒ±r?",
                        options: ["6", "8", "10", "12"],
                        correct: 1
                    },
                    {
                        question: "ƒ∞ki ardƒ±≈üƒ±k √ßift sayƒ±nƒ±n toplamƒ± 34 ise b√ºy√ºk sayƒ± ka√ßtƒ±r?",
                        options: ["16", "18", "20", "22"],
                        correct: 1
                    },
                    {
                        question: "3, 5 ve 7 sayƒ±larƒ±nƒ±n EKOK'u ka√ßtƒ±r?",
                        options: ["15", "21", "35", "105"],
                        correct: 3
                    },
                    {
                        question: "48 sayƒ±sƒ±nƒ±n asal √ßarpanlarƒ±nƒ±n toplamƒ± ka√ßtƒ±r?",
                        options: ["5", "7", "9", "11"],
                        correct: 0
                    },
                    {
                        question: "Bir sayƒ±nƒ±n 3 katƒ±nƒ±n 5 fazlasƒ± 20'dir. Bu sayƒ± ka√ßtƒ±r?",
                        options: ["3", "4", "5", "6"],
                        correct: 2
                    },
                    {
                        question: "252 sayƒ±sƒ±nƒ±n ka√ß tane pozitif tam b√∂leninin birler basamaƒüƒ± 2'dir?",
                        options: ["2", "3", "4", "5"],
                        correct: 2
                    },
                    {
                        question: "4! + 3! + 2! + 1! toplamƒ± ka√ßtƒ±r?",
                        options: ["30", "31", "32", "33"],
                        correct: 3
                    },
                    {
                        question: "1'den 50'ye kadar olan sayƒ±lardan ka√ß tanesi 3'e tam b√∂l√ºn√ºr?",
                        options: ["15", "16", "17", "18"],
                        correct: 1
                    },
                    {
                        question: "A = {2, 4, 6, 8} k√ºmesinin alt k√ºme sayƒ±sƒ± ka√ßtƒ±r?",
                        options: ["8", "12", "16", "32"],
                        correct: 2
                    },
                    {
                        question: "x + y = 10 ve x ¬∑ y = 24 ise x¬≤ + y¬≤ ka√ßtƒ±r?",
                        options: ["48", "52", "56", "60"],
                        correct: 1
                    }
                ],
                2: [ // Sayƒ± Basamaklarƒ±
                    {
                        question: "3 basamaklƒ± en b√ºy√ºk tek sayƒ± ile 2 basamaklƒ± en k√º√ß√ºk √ßift sayƒ±nƒ±n toplamƒ± ka√ßtƒ±r?",
                        options: ["1008", "1009", "1010", "1011"],
                        correct: 1
                    },
                    {
                        question: "ABC √º√ß basamaklƒ± sayƒ±sƒ±nda A + B + C = 15 ve A = C ise en b√ºy√ºk ABC sayƒ±sƒ± ka√ßtƒ±r?",
                        options: ["951", "852", "753", "654"],
                        correct: 0
                    },
                    {
                        question: "4 basamaklƒ± ABCD sayƒ±sƒ± 5 ile tam b√∂l√ºn√ºyorsa D ka√ß farklƒ± deƒüer alabilir?",
                        options: ["1", "2", "3", "4"],
                        correct: 1
                    },
                    {
                        question: "ƒ∞ki basamaklƒ± AB sayƒ±sƒ± ile BA sayƒ±sƒ±nƒ±n toplamƒ± 132 ise A ¬∑ B ka√ßtƒ±r?",
                        options: ["18", "24", "27", "36"],
                        correct: 0
                    },
                    {
                        question: "345 sayƒ±sƒ±nƒ±n rakamlarƒ± toplamƒ± ka√ßtƒ±r?",
                        options: ["10", "11", "12", "13"],
                        correct: 2
                    }
                ],
                3: [ // B√∂lme ve B√∂l√ºnebilme
                    {
                        question: "144 sayƒ±sƒ± a≈üaƒüƒ±dakilerden hangisine tam b√∂l√ºnmez?",
                        options: ["6", "8", "9", "7"],
                        correct: 3
                    },
                    {
                        question: "3 ile b√∂l√ºm√ºnden kalan 2, 5 ile b√∂l√ºm√ºnden kalan 4 olan en k√º√ß√ºk pozitif tam sayƒ± ka√ßtƒ±r?",
                        options: ["14", "17", "29", "44"],
                        correct: 0
                    },
                    {
                        question: "72'nin pozitif tam b√∂len sayƒ±sƒ± ka√ßtƒ±r?",
                        options: ["10", "11", "12", "13"],
                        correct: 2
                    },
                    {
                        question: "A sayƒ±sƒ± 12'ye b√∂l√ºnd√ºƒü√ºnde kalan 7'dir. A sayƒ±sƒ±nƒ±n 4'e b√∂l√ºm√ºnden kalan ka√ßtƒ±r?",
                        options: ["1", "2", "3", "7"],
                        correct: 2
                    },
                    {
                        question: "Bir sayƒ± 6'ya b√∂l√ºnd√ºƒü√ºnde b√∂l√ºm 8, kalan 5'tir. Bu sayƒ± ka√ßtƒ±r?",
                        options: ["48", "51", "53", "58"],
                        correct: 2
                    }
                ]
            },
            'trk': {
                1: [
                    {
                        question: "A≈üaƒüƒ±daki c√ºmlelerin hangisinde altƒ± √ßizili s√∂zc√ºk 'sƒ±fat' olarak kullanƒ±lmƒ±≈ütƒ±r?",
                        options: ["G√ºzel konu≈üuyordu.", "G√ºzel bir g√ºnd√º.", "G√ºzeli herkes sever.", "G√ºzel gitti."],
                        correct: 1
                    },
                    {
                        question: "'Kitap okumak, insanƒ± geli≈ütirir.' c√ºmlesinde √∂zne hangisidir?",
                        options: ["Kitap", "okumak", "Kitap okumak", "insanƒ±"],
                        correct: 2
                    },
                    {
                        question: "A≈üaƒüƒ±daki s√∂zc√ºklerden hangisi 'kalƒ±n √ºnl√º' i√ßermektedir?",
                        options: ["kelebek", "gelecek", "≈üeker", "kalem"],
                        correct: 3
                    },
                    {
                        question: "'Hava √ßok sƒ±cak, pencereyi a√ßar mƒ±sƒ±n?' c√ºmlesinde ka√ß tane y√ºklem vardƒ±r?",
                        options: ["1", "2", "3", "0"],
                        correct: 1
                    },
                    {
                        question: "Hangi c√ºmlede isim tamlamasƒ± kullanƒ±lmƒ±≈ütƒ±r?",
                        options: ["Kƒ±rmƒ±zƒ± g√ºl", "Bah√ßenin g√ºlleri", "G√ºzel √ßi√ßek", "Taze sebze"],
                        correct: 1
                    }
                ]
            }
        };

        const courseNames = {
            'mat': 'Matematik',
            'trk': 'T√ºrk√ße',
            'fiz': 'Fizik',
            'kim': 'Kimya',
            'bio': 'Biyoloji'
        };

        const topicNames = {
            1: 'Temel Kavramlar',
            2: 'Sayƒ± Basamaklarƒ±',
            3: 'B√∂lme ve B√∂l√ºnebilme'
        };

        // Get questions for current test
        function getQuestions() {
            const courseQuestions = questionBank[courseId] || questionBank['mat'];
            return courseQuestions[topicId] || courseQuestions[1] || [];
        }

        let questions = getQuestions();
        let currentQuestion = 0;
        let answers = new Array(questions.length).fill(null);
        let testFinished = false;
        let timerSeconds = 600; // 10 minutes
        let timerInterval = null;

        // Initialize
        function init() {
            document.getElementById('testCourse').textContent = courseNames[courseId] || 'Matematik';
            document.getElementById('testTopic').textContent = topicNames[topicId] || 'Konu';
            document.getElementById('questionCount').textContent = questions.length;
            document.getElementById('totalQ').textContent = questions.length;

            renderNavigator();
            loadQuestion(0);
            startTimer();
        }

        // Timer
        function startTimer() {
            timerInterval = setInterval(() => {
                timerSeconds--;
                const mins = Math.floor(timerSeconds / 60);
                const secs = timerSeconds % 60;
                document.getElementById('timer').textContent =
                    `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;

                if (timerSeconds <= 0) {
                    clearInterval(timerInterval);
                    finishTest();
                }
            }, 1000);
        }

        // Navigator
        function renderNavigator() {
            const grid = document.getElementById('navigatorGrid');
            grid.innerHTML = questions.map((_, index) => {
                const isCurrent = index === currentQuestion;
                const isAnswered = answers[index] !== null;
                return `
          <div class="nav-item ${isCurrent ? 'current' : ''} ${isAnswered ? 'answered' : ''}" 
               onclick="goToQuestion(${index})">
            ${index + 1}
          </div>
        `;
            }).join('');
        }

        // Load question
        function loadQuestion(index) {
            currentQuestion = index;
            const q = questions[index];

            document.getElementById('questionBadge').textContent = index + 1;
            document.getElementById('currentQ').textContent = index + 1;
            document.getElementById('questionText').textContent = q.question;

            // Update status
            const status = document.getElementById('questionStatus');
            if (answers[index] !== null) {
                status.textContent = 'Cevaplandƒ±';
                status.className = 'question-status answered';
            } else {
                status.textContent = 'Cevaplanmadƒ±';
                status.className = 'question-status unanswered';
            }

            // Render options
            const optionsList = document.getElementById('optionsList');
            const letters = ['A', 'B', 'C', 'D', 'E'];

            optionsList.innerHTML = q.options.map((option, i) => {
                const isSelected = answers[index] === i;
                let className = 'option';
                if (testFinished) {
                    if (i === q.correct) {
                        className += ' correct';
                    } else if (isSelected && i !== q.correct) {
                        className += ' wrong';
                    }
                } else if (isSelected) {
                    className += ' selected';
                }

                return `
          <div class="${className}" onclick="${testFinished ? '' : `selectOption(${i})`}">
            <div class="option-letter">${letters[i]}</div>
            <div class="option-text">${option}</div>
          </div>
        `;
            }).join('');

            // Update navigation buttons
            document.getElementById('prevBtn').disabled = index === 0;
            document.getElementById('nextBtn').disabled = index === questions.length - 1;

            // Update progress
            updateProgress();
            renderNavigator();
        }

        // Select option
        function selectOption(optionIndex) {
            if (testFinished) return;
            answers[currentQuestion] = optionIndex;
            loadQuestion(currentQuestion);
        }

        // Clear answer
        function clearAnswer() {
            if (testFinished) return;
            answers[currentQuestion] = null;
            loadQuestion(currentQuestion);
        }

        // Navigation
        function prevQuestion() {
            if (currentQuestion > 0) {
                loadQuestion(currentQuestion - 1);
            }
        }

        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                loadQuestion(currentQuestion + 1);
            }
        }

        function goToQuestion(index) {
            loadQuestion(index);
        }

        // Update progress
        function updateProgress() {
            const answered = answers.filter(a => a !== null).length;
            const percent = Math.round((answered / questions.length) * 100);

            document.getElementById('progressText').textContent = `${answered}/${questions.length}`;
            document.getElementById('progressCircle').style.setProperty('--progress', `${percent}%`);
        }

        // Finish test
        function finishTest() {
            if (timerInterval) clearInterval(timerInterval);
            testFinished = true;

            // Calculate results
            let correct = 0;
            let wrong = 0;
            let empty = 0;

            questions.forEach((q, i) => {
                if (answers[i] === null) {
                    empty++;
                } else if (answers[i] === q.correct) {
                    correct++;
                } else {
                    wrong++;
                }
            });

            // Net calculation: correct - (wrong / 4)
            const net = correct - (wrong / 4);

            // Update results display
            document.getElementById('correctCount').textContent = correct;
            document.getElementById('wrongCount').textContent = wrong;
            document.getElementById('emptyCount').textContent = empty;
            document.getElementById('netScore').textContent = net.toFixed(2);

            // Result message based on performance
            const percentage = (correct / questions.length) * 100;
            if (percentage >= 80) {
                document.getElementById('resultsIcon').textContent = 'üèÜ';
                document.getElementById('resultsTitle').textContent = 'M√ºkemmel!';
                document.getElementById('resultsSubtitle').textContent = 'Harika bir performans g√∂sterdiniz!';
            } else if (percentage >= 60) {
                document.getElementById('resultsIcon').textContent = 'üéâ';
                document.getElementById('resultsTitle').textContent = 'Ba≈üarƒ±lƒ±!';
                document.getElementById('resultsSubtitle').textContent = 'G√ºzel bir sonu√ß, √ßalƒ±≈ümaya devam!';
            } else if (percentage >= 40) {
                document.getElementById('resultsIcon').textContent = 'üìö';
                document.getElementById('resultsTitle').textContent = 'Geli≈ütirilmeli';
                document.getElementById('resultsSubtitle').textContent = 'Konuyu tekrar g√∂zden ge√ßirmenizi √∂neririz.';
            } else {
                document.getElementById('resultsIcon').textContent = 'üí™';
                document.getElementById('resultsTitle').textContent = 'Daha Fazla √áalƒ±≈üma Gerekli';
                document.getElementById('resultsSubtitle').textContent = 'Video dersleri tekrar izleyip denemenizi √∂neririz.';
            }

            // Save test result
            saveTestResult(correct, wrong, empty, net);

            // Show results
            document.getElementById('resultsOverlay').classList.add('active');
        }

        // Save test result
        function saveTestResult(correct, wrong, empty, net) {
            const results = JSON.parse(localStorage.getItem(`testResults_${currentUser.email}`)) || [];
            results.push({
                date: new Date().toISOString(),
                category: category,
                course: courseId,
                topic: topicId,
                correct: correct,
                wrong: wrong,
                empty: empty,
                net: net,
                total: questions.length
            });
            localStorage.setItem(`testResults_${currentUser.email}`, JSON.stringify(results));

            // Update user stats
            const stats = JSON.parse(localStorage.getItem(`stats_${currentUser.email}`)) || {
                videosWatched: 0,
                testsCompleted: 0,
                vboPercent: 0,
                streakDays: 0
            };
            stats.testsCompleted++;
            localStorage.setItem(`stats_${currentUser.email}`, JSON.stringify(stats));
        }

        // Review answers
        function reviewAnswers() {
            document.getElementById('resultsOverlay').classList.remove('active');
            loadQuestion(0);
        }

        // Go back
        function goBack() {
            window.location.href = `topics.html?category=${category}&course=${courseId}`;
        }

        // Confirm exit
        function confirmExit() {
            if (confirm('Testi bƒ±rakmak istediƒüinizden emin misiniz? Cevaplarƒ±nƒ±z kaydedilmeyecek.')) {
                window.location.href = `topics.html?category=${category}&course=${courseId}`;
            }
        }

        init();
    </script>
</body>

</html>